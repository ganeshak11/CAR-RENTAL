<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Your Car - FlexiCarz</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="navbar">
    <div class="container">
      <div class="navbar-content">
        <div class="logo">
          <span>FlexiCarz</span>
        </div>
        <button class="hamburger-menu" id="hamburgerBtn" aria-label="Toggle menu">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
        <nav class="nav-links" id="navMenu">
          <a href="index.html" class="nav-link">Home</a>
          <a href="vehicles.html" class="nav-link">Vehicles</a>
          <a href="booking.html" class="nav-link active">Booking</a>
        </nav>
        <div class="nav-actions">
          <span class="user-name" id="userName"></span>
          <button id="logoutBtn" class="btn-logout">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <section class="booking-section">
    <div class="container">
      <div class="section-header">
        <h2>Complete Your Booking</h2>
        <p>Quick and simple booking process</p>
      </div>

      <div class="booking-container">
        <div class="booking-card">
          <form id="bookingForm" class="booking-form">
            <div class="form-sections">
              <div class="form-section">
                <h4>üë§ Personal Information</h4>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="Enter your full name" required />
                  </div>
                  <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="your@email.com" required />
                  </div>
                  <div class="form-group">
                    <label for="age">Age</label>
                    <input type="number" id="age" min="18" max="60" placeholder="18-60" required />
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h4>üöó Vehicle Selection</h4>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="selectedBrand">Select Brand</label>
                    <select id="selectedBrand" required>
                      <option value="">Choose a brand...</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="selectedCar">Select Model</label>
                    <select id="selectedCar" required disabled>
                      <option value="">First select a brand...</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h4>üìÖ Rental Details</h4>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="startDate">Pickup Date</label>
                    <input type="date" id="startDate" required />
                  </div>
                  <div class="form-group">
                    <label for="endDate">Return Date</label>
                    <input type="date" id="endDate" required />
                  </div>
                </div>
              </div>
            </div>

            <div class="booking-summary-card">
              <div class="summary-header">
                <h3>üìä Booking Summary</h3>
              </div>
              <div class="summary-content">
                <div class="summary-item">
                  <span class="summary-label">Vehicle:</span>
                  <span id="summaryVehicle" class="summary-value">Select a vehicle</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Duration:</span>
                  <span id="summaryDays" class="summary-value">0 days</span>
                </div>
                <div class="summary-item total">
                  <span class="summary-label">Total Amount:</span>
                  <span id="summaryTotal" class="summary-total">‚Çπ0</span>
                </div>
              </div>
            </div>

            <button type="submit" class="btn btn-primary btn-lg btn-full">
              Proceed to Payment
            </button>

            <p id="confirmationMsg" class="message"></p>
          </form>
        </div>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
  <script>
    if (!isAuthenticated()) {
      alert("Please login first!");
      window.location.href = "login.html";
    }

    async function checkVerification() {
      try {
        const user = getCurrentUser();
        if (user) {
          const { data } = await window.supabase
            .from('user_profiles')
            .select('verification_status')
            .eq('user_id', user.id)
            .single();

          const status = data?.verification_status || 'pending';
          if (status !== 'verified') {
            document.querySelector('.booking-container').innerHTML = `
              <div class="verification-required">
                <h3>‚ö†Ô∏è Document Verification Required</h3>
                <p>Please verify your documents before proceeding with bookings.</p>
                <a href="verify-documents.html" class="btn btn-primary">Verify Documents</a>
              </div>
            `;
            return false;
          }
        }
        return true;
      } catch (error) {
        console.error('Error checking verification:', error);
        return false;
      }
    }

    checkVerification();
  </script>
  <script src="script.js"></script>
</body>
</html>
